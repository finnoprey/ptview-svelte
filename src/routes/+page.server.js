import { onMount } from "svelte";
import { page } from '$app/stores'
import { redirect } from '@sveltejs/kit';
import { DEV_ID, DEV_KEY, BASE_URL } from '$env/static/private';

const PTV_API_BASE_URL = 'https://timetableapi.ptv.vic.gov.au'
const PTV_API_VERSION = 'v3'
const DISTANCE = 1000
const MAX_RESULTS = 2

const USE_FAKE = true // FAKE api data to reduce requests

// jsonify output of fake api request
// const FAKE = '{"stops":[{"disruption_ids":[],"stop_distance":110.942635,"stop_suburb":"Brunswick East","stop_name":"Albert St/Nicholson St #22 ","stop_id":2936,"route_type":1,"routes":[{"route_type":1,"route_id":1041,"route_name":"East Brunswick - St Kilda Beach","route_number":"96","route_gtfs_id":"3-096","geopath":[],"directions":{"36":{"direction_id":36,"direction_name":"East Brunswick","route_id":1041,"route_type":1},"37":{"direction_id":37,"direction_name":"St Kilda Beach","route_id":1041,"route_type":1}},"departures":[{"stop_id":2936,"route_id":1041,"run_id":37593,"run_ref":"37593","direction_id":36,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:06:00Z","estimated_departure_utc":"2024-05-20T19:06:00Z","at_platform":false,"platform_number":null,"flags":"S_WCA-RUN_0","departure_sequence":0,"direction_from_name":"St Kilda Beach","direction_to_name":"East Brunswick"},{"stop_id":2936,"route_id":1041,"run_id":38063,"run_ref":"38063","direction_id":37,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:14:00Z","estimated_departure_utc":"2024-05-20T19:14:00Z","at_platform":false,"platform_number":null,"flags":"S_WCA-RUN_3","departure_sequence":0,"direction_from_name":"East Brunswick","direction_to_name":"St Kilda Beach"},{"stop_id":2936,"route_id":1041,"run_id":37594,"run_ref":"37594","direction_id":36,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:21:00Z","estimated_departure_utc":"2024-05-20T19:21:00Z","at_platform":false,"platform_number":null,"flags":"S_WCA-RUN_1","departure_sequence":0,"direction_from_name":"St Kilda Beach","direction_to_name":"East Brunswick"},{"stop_id":2936,"route_id":1041,"run_id":38064,"run_ref":"38064","direction_id":37,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:29:00Z","estimated_departure_utc":"2024-05-20T19:29:00Z","at_platform":false,"platform_number":null,"flags":"S_WCA-RUN_4","departure_sequence":0,"direction_from_name":"East Brunswick","direction_to_name":"St Kilda Beach"}]}],"stop_latitude":-37.77042,"stop_longitude":144.979828,"stop_landmark":"","stop_sequence":0},{"disruption_ids":[],"stop_distance":232.163254,"stop_suburb":"Fitzroy North","stop_name":"Glenlyon Rd/Nicholson St #21 ","stop_id":2937,"route_type":1,"routes":[{"route_type":1,"route_id":1041,"route_name":"East Brunswick - St Kilda Beach","route_number":"96","route_gtfs_id":"3-096","geopath":[],"directions":{"37":{"direction_id":37,"direction_name":"St Kilda Beach","route_id":1041,"route_type":1}},"departures":[{"stop_id":2937,"route_id":1041,"run_id":38063,"run_ref":"38063","direction_id":37,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:15:00Z","estimated_departure_utc":"2024-05-20T19:15:00Z","at_platform":false,"platform_number":null,"flags":"S_WCA-RUN_3","departure_sequence":0,"direction_from_name":"","direction_to_name":"St Kilda Beach"},{"stop_id":2937,"route_id":1041,"run_id":38064,"run_ref":"38064","direction_id":37,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:30:00Z","estimated_departure_utc":"2024-05-20T19:30:00Z","at_platform":false,"platform_number":null,"flags":"S_WCA-RUN_4","departure_sequence":0,"direction_from_name":"","direction_to_name":"St Kilda Beach"}]}],"stop_latitude":-37.7731857,"stop_longitude":144.979279,"stop_landmark":"","stop_sequence":0},{"disruption_ids":[],"stop_distance":254.85199,"stop_suburb":"Brunswick East","stop_name":"Nicholson St/Glenlyon Rd ","stop_id":25390,"route_type":2,"routes":[{"route_type":2,"route_id":15946,"route_name":"Moonee Ponds - Westgarth Station via Brunswick","route_number":"506","route_gtfs_id":"4-506","geopath":[],"directions":{"68":{"direction_id":68,"direction_name":"Moonee Ponds","route_id":15946,"route_type":2},"125":{"direction_id":125,"direction_name":"Westgarth","route_id":15946,"route_type":2}},"departures":[{"stop_id":25390,"route_id":15946,"run_id":85235,"run_ref":"85235","direction_id":125,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:05:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-RUN_0","departure_sequence":0,"direction_from_name":"Moonee Ponds","direction_to_name":"Westgarth"},{"stop_id":25390,"route_id":15946,"run_id":-1,"run_ref":"39-506--1-MF6-1852","direction_id":125,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:05:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"","departure_sequence":0,"direction_from_name":"Moonee Ponds","direction_to_name":"Westgarth"},{"stop_id":25390,"route_id":15946,"run_id":112136,"run_ref":"112136","direction_id":68,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:17:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"Westgarth","direction_to_name":"Moonee Ponds"},{"stop_id":25390,"route_id":15946,"run_id":-1,"run_ref":"39-506--1-MF6-1799","direction_id":68,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:17:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"","departure_sequence":0,"direction_from_name":"Westgarth","direction_to_name":"Moonee Ponds"}]}],"stop_latitude":-37.773407,"stop_longitude":144.978836,"stop_landmark":"","stop_sequence":0},{"disruption_ids":[],"stop_distance":316.173737,"stop_suburb":"Brunswick East","stop_name":"John St/Glenlyon Rd ","stop_id":25389,"route_type":2,"routes":[{"route_type":2,"route_id":15946,"route_name":"Moonee Ponds - Westgarth Station via Brunswick","route_number":"506","route_gtfs_id":"4-506","geopath":[],"directions":{"68":{"direction_id":68,"direction_name":"Moonee Ponds","route_id":15946,"route_type":2},"125":{"direction_id":125,"direction_name":"Westgarth","route_id":15946,"route_type":2}},"departures":[{"stop_id":25389,"route_id":15946,"run_id":112217,"run_ref":"112217","direction_id":125,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:04:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"Moonee Ponds","direction_to_name":"Westgarth"},{"stop_id":25389,"route_id":15946,"run_id":-1,"run_ref":"39-506--1-MF6-1852","direction_id":125,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:04:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"","departure_sequence":0,"direction_from_name":"Moonee Ponds","direction_to_name":"Westgarth"},{"stop_id":25389,"route_id":15946,"run_id":112136,"run_ref":"112136","direction_id":68,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:18:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"Westgarth","direction_to_name":"Moonee Ponds"},{"stop_id":25389,"route_id":15946,"run_id":-1,"run_ref":"39-506--1-MF6-1799","direction_id":68,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:18:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"","departure_sequence":0,"direction_from_name":"Westgarth","direction_to_name":"Moonee Ponds"}]}],"stop_latitude":-37.77311,"stop_longitude":144.976364,"stop_landmark":"","stop_sequence":0}],"disruptions":{},"status":{"version":"3.0","health":1}}'
const FAKE = '{"stops":[{"disruption_ids":[],"stop_distance":58.53338,"stop_suburb":"Melbourne City","stop_name":"Federation Square/Swanston St #13 ","stop_id":2204,"route_type":1,"routes":[{"route_type":1,"route_id":721,"route_name":"East Coburg - South Melbourne Beach","route_number":"1","route_gtfs_id":"3-001","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"East Coburg","route_id":721,"route_type":1},"1":{"direction_id":1,"direction_name":"South Melbourne Beach","route_id":721,"route_type":1}},"departures":[{"stop_id":2204,"route_id":721,"run_id":566,"run_ref":"566","direction_id":1,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:08:00Z","estimated_departure_utc":"2024-05-20T19:08:00Z","at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"East Coburg","direction_to_name":"South Melbourne Beach"},{"stop_id":2204,"route_id":721,"run_id":567,"run_ref":"567","direction_id":1,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:27:00Z","estimated_departure_utc":"2024-05-20T19:27:00Z","at_platform":false,"platform_number":null,"flags":"RUN_1","departure_sequence":0,"direction_from_name":"East Coburg","direction_to_name":"South Melbourne Beach"},{"stop_id":2204,"route_id":721,"run_id":168,"run_ref":"168","direction_id":0,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:50:00Z","estimated_departure_utc":"2024-05-20T19:50:00Z","at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"South Melbourne Beach","direction_to_name":"East Coburg"},{"stop_id":2204,"route_id":721,"run_id":169,"run_ref":"169","direction_id":0,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:05:00Z","estimated_departure_utc":"2024-05-20T20:05:00Z","at_platform":false,"platform_number":null,"flags":"RUN_1","departure_sequence":0,"direction_from_name":"South Melbourne Beach","direction_to_name":"East Coburg"}]},{"route_type":1,"route_id":724,"route_name":"Melbourne University - Kew via St Kilda Beach","route_number":"16","route_gtfs_id":"3-016","geopath":[],"directions":{"8":{"direction_id":8,"direction_name":"Kew via St Kilda Beach","route_id":724,"route_type":1},"9":{"direction_id":9,"direction_name":"Melbourne University via St Kilda Beach","route_id":724,"route_type":1}},"departures":[{"stop_id":2204,"route_id":724,"run_id":7289,"run_ref":"7289","direction_id":8,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:54:00Z","estimated_departure_utc":"2024-05-20T19:54:00Z","at_platform":false,"platform_number":null,"flags":"RUN_4","departure_sequence":0,"direction_from_name":"Melbourne University via St Kilda Beach","direction_to_name":"Kew via St Kilda Beach"},{"stop_id":2204,"route_id":724,"run_id":7644,"run_ref":"7644","direction_id":9,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:57:00Z","estimated_departure_utc":"2024-05-20T19:57:00Z","at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"Kew via St Kilda Beach","direction_to_name":"Melbourne University via St Kilda Beach"},{"stop_id":2204,"route_id":724,"run_id":7291,"run_ref":"7291","direction_id":8,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:12:00Z","estimated_departure_utc":"2024-05-20T20:12:00Z","at_platform":false,"platform_number":null,"flags":"RUN_6","departure_sequence":0,"direction_from_name":"Melbourne University via St Kilda Beach","direction_to_name":"Kew via St Kilda Beach"},{"stop_id":2204,"route_id":724,"run_id":7645,"run_ref":"7645","direction_id":9,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:18:00Z","estimated_departure_utc":"2024-05-20T20:18:00Z","at_platform":false,"platform_number":null,"flags":"RUN_1","departure_sequence":0,"direction_from_name":"Kew via St Kilda Beach","direction_to_name":"Melbourne University via St Kilda Beach"}]},{"route_type":1,"route_id":909,"route_name":"Melbourne University - East Brighton","route_number":"64","route_gtfs_id":"3-064","geopath":[],"directions":{"13":{"direction_id":13,"direction_name":"Melbourne University","route_id":909,"route_type":1},"25":{"direction_id":25,"direction_name":"East Brighton","route_id":909,"route_type":1}},"departures":[{"stop_id":2204,"route_id":909,"run_id":25522,"run_ref":"25522","direction_id":13,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:51:00Z","estimated_departure_utc":"2024-05-20T19:51:00Z","at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"East Brighton","direction_to_name":"Melbourne University"},{"stop_id":2204,"route_id":909,"run_id":25523,"run_ref":"25523","direction_id":13,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:10:00Z","estimated_departure_utc":"2024-05-20T20:10:00Z","at_platform":false,"platform_number":null,"flags":"RUN_1","departure_sequence":0,"direction_from_name":"East Brighton","direction_to_name":"Melbourne University"},{"stop_id":2204,"route_id":909,"run_id":25201,"run_ref":"25201","direction_id":25,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:18:00Z","estimated_departure_utc":"2024-05-20T20:18:00Z","at_platform":false,"platform_number":null,"flags":"RUN_8","departure_sequence":0,"direction_from_name":"Melbourne University","direction_to_name":"East Brighton"},{"stop_id":2204,"route_id":909,"run_id":25203,"run_ref":"25203","direction_id":25,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:37:00Z","estimated_departure_utc":"2024-05-20T20:37:00Z","at_platform":false,"platform_number":null,"flags":"RUN_10","departure_sequence":0,"direction_from_name":"Melbourne University","direction_to_name":"East Brighton"}]},{"route_type":1,"route_id":913,"route_name":"Melbourne University - Carnegie","route_number":"67","route_gtfs_id":"3-067","geopath":[],"directions":{"13":{"direction_id":13,"direction_name":"Melbourne University","route_id":913,"route_type":1},"26":{"direction_id":26,"direction_name":"Carnegie","route_id":913,"route_type":1}},"departures":[{"stop_id":2204,"route_id":913,"run_id":26978,"run_ref":"26978","direction_id":13,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:47:00Z","estimated_departure_utc":"2024-05-20T19:47:00Z","at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"Carnegie","direction_to_name":"Melbourne University"},{"stop_id":2204,"route_id":913,"run_id":26979,"run_ref":"26979","direction_id":13,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:07:00Z","estimated_departure_utc":"2024-05-20T20:07:00Z","at_platform":false,"platform_number":null,"flags":"RUN_1","departure_sequence":0,"direction_from_name":"Carnegie","direction_to_name":"Melbourne University"},{"stop_id":2204,"route_id":913,"run_id":26646,"run_ref":"26646","direction_id":26,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:14:00Z","estimated_departure_utc":"2024-05-20T20:14:00Z","at_platform":false,"platform_number":null,"flags":"RUN_8","departure_sequence":0,"direction_from_name":"Melbourne University","direction_to_name":"Carnegie"},{"stop_id":2204,"route_id":913,"run_id":26648,"run_ref":"26648","direction_id":26,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:35:00Z","estimated_departure_utc":"2024-05-20T20:35:00Z","at_platform":false,"platform_number":null,"flags":"RUN_10","departure_sequence":0,"direction_from_name":"Melbourne University","direction_to_name":"Carnegie"}]},{"route_type":1,"route_id":947,"route_name":"Melbourne University - Camberwell","route_number":"72","route_gtfs_id":"3-072","geopath":[],"directions":{"13":{"direction_id":13,"direction_name":"Melbourne University","route_id":947,"route_type":1},"29":{"direction_id":29,"direction_name":"Camberwell","route_id":947,"route_type":1}},"departures":[{"stop_id":2204,"route_id":947,"run_id":30087,"run_ref":"30087","direction_id":13,"disruption_ids":[246677],"scheduled_departure_utc":"2024-05-20T19:57:00Z","estimated_departure_utc":"2024-05-20T19:57:00Z","at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"Camberwell","direction_to_name":"Melbourne University"},{"stop_id":2204,"route_id":947,"run_id":30088,"run_ref":"30088","direction_id":13,"disruption_ids":[246677],"scheduled_departure_utc":"2024-05-20T20:11:00Z","estimated_departure_utc":"2024-05-20T20:11:00Z","at_platform":false,"platform_number":null,"flags":"RUN_1","departure_sequence":0,"direction_from_name":"Camberwell","direction_to_name":"Melbourne University"},{"stop_id":2204,"route_id":947,"run_id":29737,"run_ref":"29737","direction_id":29,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:24:00Z","estimated_departure_utc":"2024-05-20T20:24:00Z","at_platform":false,"platform_number":null,"flags":"RUN_10","departure_sequence":0,"direction_from_name":"Melbourne University","direction_to_name":"Camberwell"},{"stop_id":2204,"route_id":947,"run_id":29739,"run_ref":"29739","direction_id":29,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:38:00Z","estimated_departure_utc":"2024-05-20T20:38:00Z","at_platform":false,"platform_number":null,"flags":"RUN_12","departure_sequence":0,"direction_from_name":"Melbourne University","direction_to_name":"Camberwell"}]},{"route_type":1,"route_id":1083,"route_name":"Melbourne University - Malvern","route_number":"5","route_gtfs_id":"3-005","geopath":[],"directions":{"13":{"direction_id":13,"direction_name":"Melbourne University","route_id":1083,"route_type":1},"18":{"direction_id":18,"direction_name":"Malvern (Burke Road)","route_id":1083,"route_type":1}},"departures":[{"stop_id":2204,"route_id":1083,"run_id":16398,"run_ref":"16398","direction_id":13,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:00:00Z","estimated_departure_utc":"2024-05-20T20:00:00Z","at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"Malvern (Burke Road)","direction_to_name":"Melbourne University"},{"stop_id":2204,"route_id":1083,"run_id":16399,"run_ref":"16399","direction_id":13,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:19:00Z","estimated_departure_utc":"2024-05-20T20:19:00Z","at_platform":false,"platform_number":null,"flags":"RUN_1","departure_sequence":0,"direction_from_name":"Malvern (Burke Road)","direction_to_name":"Melbourne University"},{"stop_id":2204,"route_id":1083,"run_id":16096,"run_ref":"16096","direction_id":18,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:29:00Z","estimated_departure_utc":"2024-05-20T20:29:00Z","at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"Melbourne University","direction_to_name":"Malvern (Burke Road)"},{"stop_id":2204,"route_id":1083,"run_id":16097,"run_ref":"16097","direction_id":18,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:49:00Z","estimated_departure_utc":"2024-05-20T20:49:00Z","at_platform":false,"platform_number":null,"flags":"RUN_1","departure_sequence":0,"direction_from_name":"Melbourne University","direction_to_name":"Malvern (Burke Road)"}]},{"route_type":1,"route_id":11544,"route_name":"Moreland - Glen Iris","route_number":"6","route_gtfs_id":"3-006","geopath":[],"directions":{"23":{"direction_id":23,"direction_name":"Glen Iris","route_id":11544,"route_type":1},"24":{"direction_id":24,"direction_name":"Moreland","route_id":11544,"route_type":1}},"departures":[{"stop_id":2204,"route_id":11544,"run_id":23875,"run_ref":"23875","direction_id":24,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:37:00Z","estimated_departure_utc":"2024-05-20T19:37:00Z","at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"Glen Iris","direction_to_name":"Moreland"},{"stop_id":2204,"route_id":11544,"run_id":23492,"run_ref":"23492","direction_id":23,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:52:00Z","estimated_departure_utc":"2024-05-20T19:52:00Z","at_platform":false,"platform_number":null,"flags":"RUN_5","departure_sequence":0,"direction_from_name":"Moreland","direction_to_name":"Glen Iris"},{"stop_id":2204,"route_id":11544,"run_id":23876,"run_ref":"23876","direction_id":24,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:57:00Z","estimated_departure_utc":"2024-05-20T19:57:00Z","at_platform":false,"platform_number":null,"flags":"RUN_1","departure_sequence":0,"direction_from_name":"Glen Iris","direction_to_name":"Moreland"},{"stop_id":2204,"route_id":11544,"run_id":23493,"run_ref":"23493","direction_id":23,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:15:00Z","estimated_departure_utc":"2024-05-20T20:15:00Z","at_platform":false,"platform_number":null,"flags":"RUN_6","departure_sequence":0,"direction_from_name":"Moreland","direction_to_name":"Glen Iris"}]},{"route_type":1,"route_id":15833,"route_name":"Melbourne University - East Malvern","route_number":"3","route_gtfs_id":"3-003","geopath":[],"directions":{"12":{"direction_id":12,"direction_name":"East Malvern","route_id":15833,"route_type":1},"13":{"direction_id":13,"direction_name":"Melbourne University","route_id":15833,"route_type":1}},"departures":[{"stop_id":2204,"route_id":15833,"run_id":11649,"run_ref":"11649","direction_id":13,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:55:00Z","estimated_departure_utc":"2024-05-20T19:55:00Z","at_platform":false,"platform_number":null,"flags":"RUN_0","departure_sequence":0,"direction_from_name":"East Malvern","direction_to_name":"Melbourne University"},{"stop_id":2204,"route_id":15833,"run_id":11650,"run_ref":"11650","direction_id":13,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:16:00Z","estimated_departure_utc":"2024-05-20T20:16:00Z","at_platform":false,"platform_number":null,"flags":"RUN_1","departure_sequence":0,"direction_from_name":"East Malvern","direction_to_name":"Melbourne University"},{"stop_id":2204,"route_id":15833,"run_id":11307,"run_ref":"11307","direction_id":12,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:22:00Z","estimated_departure_utc":"2024-05-20T20:22:00Z","at_platform":false,"platform_number":null,"flags":"RUN_9","departure_sequence":0,"direction_from_name":"Melbourne University","direction_to_name":"East Malvern"},{"stop_id":2204,"route_id":15833,"run_id":11309,"run_ref":"11309","direction_id":12,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:43:00Z","estimated_departure_utc":"2024-05-20T20:43:00Z","at_platform":false,"platform_number":null,"flags":"RUN_11","departure_sequence":0,"direction_from_name":"Melbourne University","direction_to_name":"East Malvern"}]}],"stop_latitude":-37.8184738,"stop_longitude":144.967987,"stop_landmark":"Federation Square","stop_sequence":0},{"disruption_ids":[],"stop_distance":63.69934,"stop_suburb":"Melbourne City","stop_name":"Flinders Street ","stop_id":1071,"route_type":0,"routes":[{"route_type":0,"route_id":1,"route_name":"Alamein","route_number":"","route_gtfs_id":"2-ALM","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Alamein","route_id":1,"route_type":0}},"departures":[{"stop_id":1071,"route_id":1,"run_id":950201,"run_ref":"950201","direction_id":0,"disruption_ids":[261006],"scheduled_departure_utc":"2024-05-20T19:28:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"3","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Alamein"},{"stop_id":1071,"route_id":1,"run_id":950203,"run_ref":"950203","direction_id":0,"disruption_ids":[261006],"scheduled_departure_utc":"2024-05-20T19:48:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"2","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Alamein"}]},{"route_type":0,"route_id":2,"route_name":"Belgrave","route_number":"","route_gtfs_id":"2-BEL","geopath":[],"directions":{"3":{"direction_id":3,"direction_name":"Belgrave","route_id":2,"route_type":0}},"departures":[{"stop_id":1071,"route_id":2,"run_id":951001,"run_ref":"951001","direction_id":3,"disruption_ids":[261006],"scheduled_departure_utc":"2024-05-20T20:00:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"2","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Belgrave"},{"stop_id":1071,"route_id":2,"run_id":951003,"run_ref":"951003","direction_id":3,"disruption_ids":[261006],"scheduled_departure_utc":"2024-05-20T20:19:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"2","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Belgrave"}]},{"route_type":0,"route_id":3,"route_name":"Craigieburn","route_number":"","route_gtfs_id":"2-B31","geopath":[],"directions":{"2":{"direction_id":2,"direction_name":"Craigieburn","route_id":3,"route_type":0}},"departures":[{"stop_id":1071,"route_id":3,"run_id":953201,"run_ref":"953201","direction_id":2,"disruption_ids":[313320,307065,261006],"scheduled_departure_utc":"2024-05-20T18:57:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"5","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Craigieburn"},{"stop_id":1071,"route_id":3,"run_id":953203,"run_ref":"953203","direction_id":2,"disruption_ids":[313320,307065,261006],"scheduled_departure_utc":"2024-05-20T19:17:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"4","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Craigieburn"}]},{"route_type":0,"route_id":4,"route_name":"Cranbourne","route_number":"","route_gtfs_id":"2-CRB","geopath":[],"directions":{"4":{"direction_id":4,"direction_name":"Cranbourne","route_id":4,"route_type":0}},"departures":[{"stop_id":1071,"route_id":4,"run_id":952201,"run_ref":"952201","direction_id":4,"disruption_ids":[310982,307065,261006],"scheduled_departure_utc":"2024-05-20T19:28:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"6","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Cranbourne"},{"stop_id":1071,"route_id":4,"run_id":952203,"run_ref":"952203","direction_id":4,"disruption_ids":[310982,307065,261006],"scheduled_departure_utc":"2024-05-20T19:46:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"6","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Cranbourne"}]},{"route_type":0,"route_id":5,"route_name":"Mernda","route_number":"","route_gtfs_id":"2-MER","geopath":[],"directions":{"9":{"direction_id":9,"direction_name":"Mernda","route_id":5,"route_type":0}},"departures":[{"stop_id":1071,"route_id":5,"run_id":949601,"run_ref":"949601","direction_id":9,"disruption_ids":[311862,261006],"scheduled_departure_utc":"2024-05-20T18:43:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"1","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Mernda"},{"stop_id":1071,"route_id":5,"run_id":949603,"run_ref":"949603","direction_id":9,"disruption_ids":[311862,261006],"scheduled_departure_utc":"2024-05-20T19:03:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"1","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Mernda"}]},{"route_type":0,"route_id":6,"route_name":"Frankston","route_number":"","route_gtfs_id":"2-FKN","geopath":[],"directions":{"5":{"direction_id":5,"direction_name":"Frankston","route_id":6,"route_type":0}},"departures":[{"stop_id":1071,"route_id":6,"run_id":952301,"run_ref":"952301","direction_id":5,"disruption_ids":[312224,310982,261006],"scheduled_departure_utc":"2024-05-20T18:41:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"8","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Frankston"},{"stop_id":1071,"route_id":6,"run_id":952303,"run_ref":"952303","direction_id":5,"disruption_ids":[312224,310982,261006],"scheduled_departure_utc":"2024-05-20T18:56:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"8","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Frankston"}]},{"route_type":0,"route_id":7,"route_name":"Glen Waverley","route_number":"","route_gtfs_id":"2-GLW","geopath":[],"directions":{"6":{"direction_id":6,"direction_name":"Glen Waverley","route_id":7,"route_type":0}},"departures":[{"stop_id":1071,"route_id":7,"run_id":950001,"run_ref":"950001","direction_id":6,"disruption_ids":[261006],"scheduled_departure_utc":"2024-05-20T19:15:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"3","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Glen Waverley"},{"stop_id":1071,"route_id":7,"run_id":950003,"run_ref":"950003","direction_id":6,"disruption_ids":[261006],"scheduled_departure_utc":"2024-05-20T19:35:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"3","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Glen Waverley"}]},{"route_type":0,"route_id":8,"route_name":"Hurstbridge","route_number":"","route_gtfs_id":"2-HBG","geopath":[],"directions":{"7":{"direction_id":7,"direction_name":"Hurstbridge","route_id":8,"route_type":0}},"departures":[{"stop_id":1071,"route_id":8,"run_id":949801,"run_ref":"949801","direction_id":7,"disruption_ids":[261006],"scheduled_departure_utc":"2024-05-20T18:58:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"1","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Hurstbridge"},{"stop_id":1071,"route_id":8,"run_id":949803,"run_ref":"949803","direction_id":7,"disruption_ids":[261006],"scheduled_departure_utc":"2024-05-20T19:18:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"1","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Hurstbridge"}]},{"route_type":0,"route_id":9,"route_name":"Lilydale","route_number":"","route_gtfs_id":"2-LIL","geopath":[],"directions":{"8":{"direction_id":8,"direction_name":"Lilydale","route_id":9,"route_type":0}},"departures":[{"stop_id":1071,"route_id":9,"run_id":951201,"run_ref":"951201","direction_id":8,"disruption_ids":[311331,261006],"scheduled_departure_utc":"2024-05-20T19:02:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"3","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Lilydale"},{"stop_id":1071,"route_id":9,"run_id":951203,"run_ref":"951203","direction_id":8,"disruption_ids":[311331,261006],"scheduled_departure_utc":"2024-05-20T19:34:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"2","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Lilydale"}]},{"route_type":0,"route_id":11,"route_name":"Pakenham","route_number":"","route_gtfs_id":"2-PKM","geopath":[],"directions":{"10":{"direction_id":10,"direction_name":"Pakenham","route_id":11,"route_type":0}},"departures":[{"stop_id":1071,"route_id":11,"run_id":952001,"run_ref":"952001","direction_id":10,"disruption_ids":[311533,310982,307065,261006],"scheduled_departure_utc":"2024-05-20T18:56:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"7","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Pakenham"},{"stop_id":1071,"route_id":11,"run_id":952003,"run_ref":"952003","direction_id":10,"disruption_ids":[311533,310982,307065,261006],"scheduled_departure_utc":"2024-05-20T19:16:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"7","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Pakenham"}]},{"route_type":0,"route_id":12,"route_name":"Sandringham","route_number":"","route_gtfs_id":"2-SDM","geopath":[],"directions":{"11":{"direction_id":11,"direction_name":"Sandringham","route_id":12,"route_type":0}},"departures":[{"stop_id":1071,"route_id":12,"run_id":988001,"run_ref":"988001","direction_id":11,"disruption_ids":[311867,261006],"scheduled_departure_utc":"2024-05-20T19:24:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"12","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Sandringham"},{"stop_id":1071,"route_id":12,"run_id":988003,"run_ref":"988003","direction_id":11,"disruption_ids":[311867,261006],"scheduled_departure_utc":"2024-05-20T19:44:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"13","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Sandringham"}]},{"route_type":0,"route_id":14,"route_name":"Sunbury","route_number":"","route_gtfs_id":"2-SYM","geopath":[],"directions":{"13":{"direction_id":13,"direction_name":"Sunbury","route_id":14,"route_type":0}},"departures":[{"stop_id":1071,"route_id":14,"run_id":954001,"run_ref":"954001","direction_id":13,"disruption_ids":[307065,261006],"scheduled_departure_utc":"2024-05-20T19:00:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"4","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Sunbury"},{"stop_id":1071,"route_id":14,"run_id":954003,"run_ref":"954003","direction_id":13,"disruption_ids":[307065,261006],"scheduled_departure_utc":"2024-05-20T19:20:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"5","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Sunbury"}]},{"route_type":0,"route_id":15,"route_name":"Upfield","route_number":"","route_gtfs_id":"2-UFD","geopath":[],"directions":{"14":{"direction_id":14,"direction_name":"Upfield","route_id":15,"route_type":0}},"departures":[{"stop_id":1071,"route_id":15,"run_id":953001,"run_ref":"953001","direction_id":14,"disruption_ids":[307065,261006],"scheduled_departure_utc":"2024-05-20T19:12:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"5","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Upfield"},{"stop_id":1071,"route_id":15,"run_id":953003,"run_ref":"953003","direction_id":14,"disruption_ids":[307065,261006],"scheduled_departure_utc":"2024-05-20T19:30:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"5","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Upfield"}]},{"route_type":0,"route_id":16,"route_name":"Werribee","route_number":"","route_gtfs_id":"2-WBE","geopath":[],"directions":{"15":{"direction_id":15,"direction_name":"Werribee","route_id":16,"route_type":0}},"departures":[{"stop_id":1071,"route_id":16,"run_id":954201,"run_ref":"954201","direction_id":15,"disruption_ids":[261006],"scheduled_departure_utc":"2024-05-20T18:49:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"10","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Werribee"},{"stop_id":1071,"route_id":16,"run_id":954401,"run_ref":"954401","direction_id":15,"disruption_ids":[261006],"scheduled_departure_utc":"2024-05-20T19:06:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"9","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Werribee"}]},{"route_type":0,"route_id":17,"route_name":"Williamstown","route_number":"","route_gtfs_id":"2-WMN","geopath":[],"directions":{"16":{"direction_id":16,"direction_name":"Williamstown","route_id":17,"route_type":0}},"departures":[{"stop_id":1071,"route_id":17,"run_id":954301,"run_ref":"954301","direction_id":16,"disruption_ids":[261006],"scheduled_departure_utc":"2024-05-20T18:58:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"10","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Williamstown"},{"stop_id":1071,"route_id":17,"run_id":954303,"run_ref":"954303","direction_id":16,"disruption_ids":[261006],"scheduled_departure_utc":"2024-05-20T19:18:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"10","flags":"","departure_sequence":0,"direction_from_name":"","direction_to_name":"Williamstown"}]},{"route_type":0,"route_id":1482,"route_name":"Showgrounds - Flemington Racecourse","route_number":"","route_gtfs_id":"2-ain","geopath":[],"directions":{"1":{"direction_id":1,"direction_name":"City (Flinders Street)","route_id":15,"route_type":0},"18":{"direction_id":18,"direction_name":"Showgrounds/Flemington","route_id":1482,"route_type":0}},"departures":[{"stop_id":1071,"route_id":1482,"run_id":982403,"run_ref":"982403","direction_id":18,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T22:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"5","flags":"","departure_sequence":0,"direction_from_name":"City (Flinders Street)","direction_to_name":"Showgrounds/Flemington"},{"stop_id":1071,"route_id":1482,"run_id":982405,"run_ref":"982405","direction_id":18,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T22:46:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":"5","flags":"","departure_sequence":0,"direction_from_name":"City (Flinders Street)","direction_to_name":"Showgrounds/Flemington"},{"stop_id":1071,"route_id":15,"run_id":73732,"run_ref":"73732","direction_id":1,"disruption_ids":[307065,261006],"scheduled_departure_utc":"2024-05-21T19:17:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-RUN_0","departure_sequence":0,"direction_from_name":"Showgrounds/Flemington","direction_to_name":"City (Flinders Street)"},{"stop_id":1071,"route_id":14,"run_id":71431,"run_ref":"71431","direction_id":1,"disruption_ids":[307065,261006],"scheduled_departure_utc":"2024-05-21T19:30:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-RUN_1","departure_sequence":0,"direction_from_name":"Showgrounds/Flemington","direction_to_name":"City (Flinders Street)"}]},{"route_type":3,"route_id":1717,"route_name":"Batemans Bay - Melbourne via Bairnsdale","route_number":"","route_gtfs_id":"5-V09","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":1717,"route_type":3},"12":{"direction_id":12,"direction_name":"Batemans Bay","route_id":1717,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1717,"run_id":17800,"run_ref":"17800","direction_id":12,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:10:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_0-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Batemans Bay"},{"stop_id":1071,"route_id":1717,"run_id":17801,"run_ref":"17801","direction_id":12,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T21:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_1-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Batemans Bay"},{"stop_id":1071,"route_id":1717,"run_id":17828,"run_ref":"17828","direction_id":0,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T22:06:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_4-DOO","departure_sequence":0,"direction_from_name":"Batemans Bay","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":1717,"run_id":17834,"run_ref":"17834","direction_id":0,"disruption_ids":[],"scheduled_departure_utc":"2024-05-21T01:41:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_10-DOO","departure_sequence":0,"direction_from_name":"Batemans Bay","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":1717,"route_name":"Batemans Bay - Melbourne via Bairnsdale","route_number":"","route_gtfs_id":"1-V09","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":1717,"route_type":3},"12":{"direction_id":12,"direction_name":"Batemans Bay","route_id":1717,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1717,"run_id":17800,"run_ref":"17800","direction_id":12,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T20:10:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_0-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Batemans Bay"},{"stop_id":1071,"route_id":1717,"run_id":17801,"run_ref":"17801","direction_id":12,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T21:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_1-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Batemans Bay"},{"stop_id":1071,"route_id":1717,"run_id":17828,"run_ref":"17828","direction_id":0,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T22:06:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_4-DOO","departure_sequence":0,"direction_from_name":"Batemans Bay","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":1717,"run_id":17834,"run_ref":"17834","direction_id":0,"disruption_ids":[],"scheduled_departure_utc":"2024-05-21T01:41:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_10-DOO","departure_sequence":0,"direction_from_name":"Batemans Bay","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":1718,"route_name":"Canberra - Melbourne via Bairnsdale","route_number":"","route_gtfs_id":"5-V13","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":1718,"route_type":3},"15":{"direction_id":15,"direction_name":"Canberra","route_id":1718,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1718,"run_id":20392,"run_ref":"20392","direction_id":15,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T21:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_0-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Canberra"},{"stop_id":1071,"route_id":1718,"run_id":20396,"run_ref":"20396","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T00:02:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_CAA-S_RER-RUN_0-DOO","departure_sequence":0,"direction_from_name":"Canberra","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":1718,"run_id":20394,"run_ref":"20394","direction_id":15,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T03:28:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_2-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Canberra"},{"stop_id":1071,"route_id":1718,"run_id":20397,"run_ref":"20397","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T06:40:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_1-DOO","departure_sequence":0,"direction_from_name":"Canberra","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":1718,"route_name":"Canberra - Melbourne via Bairnsdale","route_number":"","route_gtfs_id":"1-V13","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":1718,"route_type":3},"15":{"direction_id":15,"direction_name":"Canberra","route_id":1718,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1718,"run_id":20392,"run_ref":"20392","direction_id":15,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T21:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_0-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Canberra"},{"stop_id":1071,"route_id":1718,"run_id":20396,"run_ref":"20396","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T00:02:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_CAA-S_RER-RUN_0-DOO","departure_sequence":0,"direction_from_name":"Canberra","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":1718,"run_id":20394,"run_ref":"20394","direction_id":15,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T03:28:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_2-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Canberra"},{"stop_id":1071,"route_id":1718,"run_id":20397,"run_ref":"20397","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T06:40:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_1-DOO","departure_sequence":0,"direction_from_name":"Canberra","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":1719,"route_name":"Sale - Melbourne via Maffra & Traralgon","route_number":"","route_gtfs_id":"5-V43","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":1719,"route_type":3},"37":{"direction_id":37,"direction_name":"Sale","route_id":1719,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1719,"run_id":45882,"run_ref":"45882","direction_id":37,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T20:10:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_3-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Sale"},{"stop_id":1071,"route_id":1719,"run_id":45883,"run_ref":"45883","direction_id":37,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T21:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_4-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Sale"},{"stop_id":1071,"route_id":1719,"run_id":45911,"run_ref":"45911","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T00:02:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_CAA-S_RER-RUN_5-DOO","departure_sequence":0,"direction_from_name":"Sale","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":1719,"run_id":45915,"run_ref":"45915","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T01:41:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_9-DOO","departure_sequence":0,"direction_from_name":"Sale","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":1719,"route_name":"Sale - Melbourne via Maffra & Traralgon","route_number":"","route_gtfs_id":"1-V43","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":1719,"route_type":3},"37":{"direction_id":37,"direction_name":"Sale","route_id":1719,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1719,"run_id":45882,"run_ref":"45882","direction_id":37,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T20:10:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_3-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Sale"},{"stop_id":1071,"route_id":1719,"run_id":45883,"run_ref":"45883","direction_id":37,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T21:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_4-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Sale"},{"stop_id":1071,"route_id":1719,"run_id":45911,"run_ref":"45911","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T00:02:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_CAA-S_RER-RUN_5-DOO","departure_sequence":0,"direction_from_name":"Sale","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":1719,"run_id":45915,"run_ref":"45915","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T01:41:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_9-DOO","departure_sequence":0,"direction_from_name":"Sale","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":1720,"route_name":"Cowes and Inverloch - Melbourne via Dandenong & Koo Wee Rup","route_number":"","route_gtfs_id":"5-V15","geopath":[],"directions":{"16":{"direction_id":16,"direction_name":"Cowes or Inverloch","route_id":1720,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1720,"run_id":21520,"run_ref":"21520","direction_id":16,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:36:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_0-PUO","departure_sequence":0,"direction_from_name":"","direction_to_name":"Cowes or Inverloch"},{"stop_id":1071,"route_id":1720,"run_id":21523,"run_ref":"21523","direction_id":16,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T22:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_3-PUO","departure_sequence":0,"direction_from_name":"","direction_to_name":"Cowes or Inverloch"}]},{"route_type":3,"route_id":1720,"route_name":"Cowes and Inverloch - Melbourne via Dandenong & Koo Wee Rup","route_number":"","route_gtfs_id":"1-V15","geopath":[],"directions":{"16":{"direction_id":16,"direction_name":"Cowes or Inverloch","route_id":1720,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1720,"run_id":21520,"run_ref":"21520","direction_id":16,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:36:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_0-PUO","departure_sequence":0,"direction_from_name":"","direction_to_name":"Cowes or Inverloch"},{"stop_id":1071,"route_id":1720,"run_id":21523,"run_ref":"21523","direction_id":16,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T22:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_3-PUO","departure_sequence":0,"direction_from_name":"","direction_to_name":"Cowes or Inverloch"}]},{"route_type":3,"route_id":1721,"route_name":"Marlo - Lake Tyers Beach - Melbourne via Bairnsdale","route_number":"","route_gtfs_id":"5-V25","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":1721,"route_type":3},"23":{"direction_id":23,"direction_name":"Marlo","route_id":1721,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1721,"run_id":31124,"run_ref":"31124","direction_id":23,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T20:10:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_2-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Marlo"},{"stop_id":1071,"route_id":1721,"run_id":31152,"run_ref":"31152","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T20:41:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_1-DOO","departure_sequence":0,"direction_from_name":"Marlo","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":1721,"run_id":31125,"run_ref":"31125","direction_id":23,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T21:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_3-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Marlo"},{"stop_id":1071,"route_id":1721,"run_id":31155,"run_ref":"31155","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T22:43:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_4-DOO","departure_sequence":0,"direction_from_name":"Marlo","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":1721,"route_name":"Marlo - Lake Tyers Beach - Melbourne via Bairnsdale","route_number":"","route_gtfs_id":"1-V25","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":1721,"route_type":3},"23":{"direction_id":23,"direction_name":"Marlo","route_id":1721,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1721,"run_id":31124,"run_ref":"31124","direction_id":23,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T20:10:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_2-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Marlo"},{"stop_id":1071,"route_id":1721,"run_id":31152,"run_ref":"31152","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T20:41:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_1-DOO","departure_sequence":0,"direction_from_name":"Marlo","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":1721,"run_id":31125,"run_ref":"31125","direction_id":23,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T21:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_3-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Marlo"},{"stop_id":1071,"route_id":1721,"run_id":31155,"run_ref":"31155","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T22:43:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_4-DOO","departure_sequence":0,"direction_from_name":"Marlo","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":1722,"route_name":"Yarram - Melbourne via Koo Wee Rup & Dandenong","route_number":"","route_gtfs_id":"5-V52","geopath":[],"directions":{"40":{"direction_id":40,"direction_name":"Yarram","route_id":1722,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1722,"run_id":54921,"run_ref":"54921","direction_id":40,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:36:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_0-PUO","departure_sequence":0,"direction_from_name":"","direction_to_name":"Yarram"},{"stop_id":1071,"route_id":1722,"run_id":54924,"run_ref":"54924","direction_id":40,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T22:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_3-PUO","departure_sequence":0,"direction_from_name":"","direction_to_name":"Yarram"}]},{"route_type":3,"route_id":1722,"route_name":"Yarram - Melbourne via Koo Wee Rup & Dandenong","route_number":"","route_gtfs_id":"1-V52","geopath":[],"directions":{"40":{"direction_id":40,"direction_name":"Yarram","route_id":1722,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1722,"run_id":54921,"run_ref":"54921","direction_id":40,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T19:36:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_0-PUO","departure_sequence":0,"direction_from_name":"","direction_to_name":"Yarram"},{"stop_id":1071,"route_id":1722,"run_id":54924,"run_ref":"54924","direction_id":40,"disruption_ids":[],"scheduled_departure_utc":"2024-05-20T22:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_3-PUO","departure_sequence":0,"direction_from_name":"","direction_to_name":"Yarram"}]},{"route_type":3,"route_id":1823,"route_name":"Bairnsdale - Melbourne via Sale & Traralgon","route_number":"","route_gtfs_id":"1-V08","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":1823,"route_type":3},"11":{"direction_id":11,"direction_name":"Bairnsdale","route_id":1823,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1823,"run_id":16807,"run_ref":"16807","direction_id":11,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T19:36:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_0-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Bairnsdale"},{"stop_id":1071,"route_id":1823,"run_id":16809,"run_ref":"16809","direction_id":11,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T20:10:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_2-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Bairnsdale"},{"stop_id":1071,"route_id":1823,"run_id":16774,"run_ref":"16774","direction_id":0,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T20:41:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_0-DOO","departure_sequence":0,"direction_from_name":"Bairnsdale","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":1823,"run_id":16777,"run_ref":"16777","direction_id":0,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T22:06:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_3-DOO","departure_sequence":0,"direction_from_name":"Bairnsdale","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":1823,"route_name":"Bairnsdale - Melbourne via Sale & Traralgon","route_number":"","route_gtfs_id":"5-V08","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":1823,"route_type":3},"11":{"direction_id":11,"direction_name":"Bairnsdale","route_id":1823,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1823,"run_id":16807,"run_ref":"16807","direction_id":11,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T19:36:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_0-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Bairnsdale"},{"stop_id":1071,"route_id":1823,"run_id":16809,"run_ref":"16809","direction_id":11,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T20:10:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_2-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Bairnsdale"},{"stop_id":1071,"route_id":1823,"run_id":16774,"run_ref":"16774","direction_id":0,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T20:41:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_0-DOO","departure_sequence":0,"direction_from_name":"Bairnsdale","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":1823,"run_id":16777,"run_ref":"16777","direction_id":0,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T22:06:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_3-DOO","departure_sequence":0,"direction_from_name":"Bairnsdale","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":1824,"route_name":"Traralgon - Melbourne via Morwell & Moe & Pakenham","route_number":"","route_gtfs_id":"1-V48","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":1824,"route_type":3},"39":{"direction_id":39,"direction_name":"Traralgon","route_id":1824,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1824,"run_id":47825,"run_ref":"47825","direction_id":39,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T20:10:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_2-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Traralgon"},{"stop_id":1071,"route_id":1824,"run_id":47826,"run_ref":"47826","direction_id":39,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T21:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_3-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Traralgon"},{"stop_id":1071,"route_id":1824,"run_id":47849,"run_ref":"47849","direction_id":0,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T22:06:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_2-DOO","departure_sequence":0,"direction_from_name":"Traralgon","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":1824,"run_id":47850,"run_ref":"47850","direction_id":0,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T22:43:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_3-DOO","departure_sequence":0,"direction_from_name":"Traralgon","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":1824,"route_name":"Traralgon - Melbourne via Morwell & Moe & Pakenham","route_number":"","route_gtfs_id":"5-V48","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":1824,"route_type":3},"39":{"direction_id":39,"direction_name":"Traralgon","route_id":1824,"route_type":3}},"departures":[{"stop_id":1071,"route_id":1824,"run_id":47825,"run_ref":"47825","direction_id":39,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T20:10:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-RUN_2-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Traralgon"},{"stop_id":1071,"route_id":1824,"run_id":47826,"run_ref":"47826","direction_id":39,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T21:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_RER-RUN_3-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Traralgon"},{"stop_id":1071,"route_id":1824,"run_id":47849,"run_ref":"47849","direction_id":0,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T22:06:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_2-DOO","departure_sequence":0,"direction_from_name":"Traralgon","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":1824,"run_id":47850,"run_ref":"47850","direction_id":0,"disruption_ids":[312936,310290],"scheduled_departure_utc":"2024-05-20T22:43:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_WCA-S_VTR-S_PKS-RUN_3-DOO","departure_sequence":0,"direction_from_name":"Traralgon","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":5838,"route_name":"Paynesville - Melbourne via Bairnsdale","route_number":"","route_gtfs_id":"5-pay","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":5838,"route_type":3},"43":{"direction_id":43,"direction_name":"Paynesville","route_id":5838,"route_type":3}},"departures":[{"stop_id":1071,"route_id":5838,"run_id":58107,"run_ref":"58107","direction_id":43,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T21:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_VTR-S_RER-RUN_0-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Paynesville"},{"stop_id":1071,"route_id":5838,"run_id":58102,"run_ref":"58102","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T00:02:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_VTR-S_CAA-S_RER-RUN_0-DOO","departure_sequence":0,"direction_from_name":"Paynesville","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":5838,"run_id":58109,"run_ref":"58109","direction_id":43,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T03:28:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_VTR-S_RER-RUN_2-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Paynesville"},{"stop_id":1071,"route_id":5838,"run_id":58104,"run_ref":"58104","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T06:40:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_VTR-S_RER-RUN_2-DOO","departure_sequence":0,"direction_from_name":"Paynesville","direction_to_name":"Melbourne"}]},{"route_type":3,"route_id":5838,"route_name":"Paynesville - Melbourne via Bairnsdale","route_number":"","route_gtfs_id":"1-pay","geopath":[],"directions":{"0":{"direction_id":0,"direction_name":"Melbourne","route_id":5838,"route_type":3},"43":{"direction_id":43,"direction_name":"Paynesville","route_id":5838,"route_type":3}},"departures":[{"stop_id":1071,"route_id":5838,"run_id":58107,"run_ref":"58107","direction_id":43,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-20T21:23:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_VTR-S_RER-RUN_0-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Paynesville"},{"stop_id":1071,"route_id":5838,"run_id":58102,"run_ref":"58102","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T00:02:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_VTR-S_CAA-S_RER-RUN_0-DOO","departure_sequence":0,"direction_from_name":"Paynesville","direction_to_name":"Melbourne"},{"stop_id":1071,"route_id":5838,"run_id":58109,"run_ref":"58109","direction_id":43,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T03:28:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_VTR-S_RER-RUN_2-PUO","departure_sequence":0,"direction_from_name":"Melbourne","direction_to_name":"Paynesville"},{"stop_id":1071,"route_id":5838,"run_id":58104,"run_ref":"58104","direction_id":0,"disruption_ids":[312936],"scheduled_departure_utc":"2024-05-21T06:40:00Z","estimated_departure_utc":null,"at_platform":false,"platform_number":null,"flags":"S_VTR-S_RER-RUN_2-DOO","departure_sequence":0,"direction_from_name":"Paynesville","direction_to_name":"Melbourne"}]}],"stop_latitude":-37.81831,"stop_longitude":144.966965,"stop_landmark":"","stop_sequence":0}],"disruptions":{},"status":{"version":"3.0","health":1},"USE_FAKE":false}'

const options = {
  enableHighAccuracy: true,
  timeout: 5000,
  maximumAge: 0,
};


export async function load({ url }) {
  const latitude = url.searchParams.get('latitude')
  const longitude = url.searchParams.get('longitude') 
  
  let location_error = (latitude == undefined || longitude == undefined)

  if (!latitude || !longitude) {
    throw redirect(302, '/positioner');
  }

  // type 0: train, type 1: tram, type 2: bus
  
  async function ptv_request(content) {
    const combiner = content.includes('?') ? '&' : '?';
    const url_path = `/${PTV_API_VERSION}${content}${combiner}devid=${DEV_ID}`

    console.log(PTV_API_BASE_URL + url_path)
  
    const signature_response = await fetch(`${BASE_URL}/api/hmacsha1?key=${DEV_KEY}&value=${encodeURIComponent(url_path)}`)
    const signature = await signature_response.text()
  
    const response = await fetch(`${PTV_API_BASE_URL}${url_path}&signature=${signature}`);
    const body = await response.json();

    return body;
  }

  if (USE_FAKE) {
    let data = JSON.parse(FAKE)
    data.USE_FAKE = true // passthrough that data has been faked
    return data
  }

  let data = await ptv_request(`/stops/location/${latitude},${longitude}?max_distance=${DISTANCE}&max_results=${MAX_RESULTS}`)
  console.log('+page.server.js: version = ' + data.status.version)
  console.log('+page.server.js: no. stops = ' + data.stops.length)
  for (let stop of data.stops) {
    for (let route of stop.routes) {
      let departure_data = await ptv_request(`/departures/route_type/${route.route_type}/stop/${stop.stop_id}/route/${route.route_id}?max_results=2&expand=Direction`)
      route.directions = departure_data.directions
      
      for (let departure of departure_data.departures) {
        let direction_to_id = departure.direction_id;
    
        // Assuming route.directions is an object with direction_id as keys
        let route_directions_list = Object.values(route.directions).map(direction => direction.direction_id);
    
        let direction_from_id = route_directions_list.find(number => number !== direction_to_id);
    
        // Find direction names using direction IDs
        let direction_to_name = route.directions[direction_to_id]?.direction_name || '';
        let direction_from_name = route.directions[direction_from_id]?.direction_name || '';
    
        // Assign direction names to departure object
        departure.direction_from_name = direction_from_name;
        departure.direction_to_name = direction_to_name;
    }

      route.departures = departure_data.departures
    }
  }

  data.USE_FAKE = false // passthrough that data is real
  return data;
}